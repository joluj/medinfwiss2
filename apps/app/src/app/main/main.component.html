<mat-toolbar color="primary">
  <span>Wechselwirkungen-Checker</span>
  <div class="spacer"></div>
  <button
    mat-button
    aria-label="Enzyme"
    matTooltip="Enzyme"
    routerLink="/enzym-wechselwirkungen"
  >
    Enzyme
  </button>
  <button
    mat-button
    aria-label="Interaktionen"
    matTooltip="Interaktionen"
    routerLink="/interaktionen"
  >
    Interaktionen
  </button>
  <a
    mat-button
    aria-label="Lizenzen"
    matTooltip="Lizenzen"
    href="https://wwwcip.cs.fau.de/~sa63pata/medinfwiss2/3rdpartylicenses.txt"
  >
    Lizenzen
  </a>
  <a
    mat-button
    aria-label="Sourcecode"
    matTooltip="Sourcecode"
    href="https://github.com/joluj/medinfwiss2"
    target="_blank"
  >
    Sourcecode
  </a>
</mat-toolbar>

<main>
  <div class="menu-list patient-list">
    <h3>Patienten</h3>

    <mat-selection-list
      [multiple]="false"
      (selectionChange)="stateService.selectPatient($event.options[0].value)"
      aria-selected="false"
    >
      <mat-list-option
        *ngFor="let patient of stateService.patients$ | async"
        [value]="patient.id"
        [selected]="(stateService.selectedPatient$ | async)?.id === patient.id"
      >
        {{ patient.name }}
      </mat-list-option>
      <mat-list-item class="new-patient">
        <button mat-stroked-button (click)="addPatient()">Neuer Patient</button>
      </mat-list-item>
    </mat-selection-list>
  </div>

  <div
    class="menu-list medikation-list"
    *ngIf="stateService.selectedPatient$ | async; let patient"
  >
    <h3>Medikation</h3>

    <mat-form-field>
      <mat-label>Substrat</mat-label>
      <input
        type="text"
        aria-label="Substrat"
        matInput
        [formControl]="substrateControl"
        [matAutocomplete]="auto"
      />
      <mat-autocomplete #auto="matAutocomplete" [autoActiveFirstOption]="true">
        <mat-option
          *ngFor="let substrat of filteredOptions$ | async"
          [value]="substrat"
          (onSelectionChange)="
            addMedikation(patient.id, $event.source.value);
            substrateControl.setValue('')
          "
        >
          {{ substrat }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <mat-list>
      <mat-list-item *ngFor="let medikation of patient.medikation">
        <mat-icon
          matListItemIcon
          class="clickable"
          (click)="stateService.removeMedikation(patient.id, medikation)"
        >
          delete
        </mat-icon>
        <p matListItemTitle>
          {{ medikation }}
        </p>
      </mat-list-item>
    </mat-list>
  </div>

  <div
    class="wechselwirkungen spacer"
    *ngIf="wechselwirkungen$ | async; let wechselwirkungen"
  >
    <h2>Erkannte Wechselwirkungen</h2>

    <mat-table
      [dataSource]="wechselwirkungen"
      matSort
      (matSortChange)="sorting.next($event)"
    >
      <ng-container matColumnDef="enzym">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          Enzym
        </mat-header-cell>
        <mat-cell *matCellDef="let row">{{ row.enzym }}</mat-cell>
      </ng-container>
      <ng-container matColumnDef="substrat">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          Wirkstoff
        </mat-header-cell>
        <mat-cell *matCellDef="let row">{{ row.substrat }}</mat-cell>
      </ng-container>
      <ng-container matColumnDef="reason">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          Grund
        </mat-header-cell>
        <mat-cell *matCellDef="let row">{{ row.reason }}</mat-cell>
      </ng-container>
      <ng-container matColumnDef="wert">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          Wirkung
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
          <div [ngSwitch]="row.wert">
            <ng-container *ngSwitchCase="-1"> Hemmung </ng-container>
            <ng-container *ngSwitchCase="1">
              schwache oder undefinierte Verst채rkung
            </ng-container>
            <ng-container *ngSwitchCase="2">
              Mittlere Verst채rkung
            </ng-container>
            <ng-container *ngSwitchCase="3">
              Ausgepr채gte Verst채rkung
            </ng-container>
          </div>
        </mat-cell>
      </ng-container>

      <mat-header-row
        *matHeaderRowDef="wechselwirkungenColumns"
      ></mat-header-row>
      <mat-row *matRowDef="let row; columns: wechselwirkungenColumns"></mat-row>
    </mat-table>
  </div>
</main>
